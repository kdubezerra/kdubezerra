%
% exemplo genérico de uso da classe iiufrgs.cls
% $Id: iiufrgs.tex,v 4.6 2003/11/21 22:36:13 avila Exp $
%
\documentclass[plano-doutorado]{iiufrgs}
% um tipo específico de monografia pode ser informado como parâmetro opcional:
%\documentclass[tese]{iiufrgs}
% monografias em inglês devem receber o parâmetro `english':
%\documentclass[diss,english]{iiufrgs}
% a opção `openright' pode ser usada para forçar inícios de capítulos
% em páginas ímpares
% \documentclass[openright]{iiufrgs}
% para gerar uma versão somente-frente, basta utilizar a opção `oneside':
% \documentclass[oneside]{iiufrgs}
\usepackage[T1]{fontenc}        % pacote para conj. de caracteres correto
\usepackage[latin1]{inputenc}   % pacote para acentuação
\usepackage{graphicx}           % pacote para importar figuras
\usepackage{times}              % pacote para usar fonte Adobe Times
%\usepackage{mathptmx}          % p/ usar fonte Adobe Times nas fórmulas
\usepackage{algorithm}
\usepackage{algorithmic}

\hyphenation{di-fe-ren-tes}
\hyphenation{re-qui-si-to}
\hyphenation{sa-tis-fa-tó-ria}
\hyphenation{a-tu-a-li-za-ções}
\hyphenation{res-trin-ge}
\hyphenation{pre-ci-sa-rão}

%\renewcomd{\listalgorithmname}{Lista de Algoritmos}

%
% Informações gerais
%
\title{Um modelo de suporte distribuído para jogos MMOG em cenários com recursos computacionais limitados%Uma proposta de arquitetura híbrida (par-a-par e cliente-servidor) para jogos online maciçamente distribuídos 
\\ (Título Provisório)}

\author{Benevides Bezerra}{Carlos Eduardo}
% alguns documentos podem ter varios autores:
%\author{Flaumann}{Frida Gutenberg}
%\author{Flaumann}{Klaus Gutenberg}

% orientador e co-orientador são opcionais (não diga isso pra eles :))
\advisor[Prof.~Dr.]{Resin Geyer}{Cláudio Fernando}
%\coadvisor[Prof.~Dr.]{Knuth}{Donald Ervin}

% a data deve ser a da defesa; se nao especificada, são gerados
% mes e ano correntes
%\date{maio}{2001}

% o nome do curso pode ser redefinido (ex. para TCs)
%\course{Curso de Especialização em Cachaça}

% o local de realização do trabalho pode ser especificado (ex. para TCs)
% com o comando \location:
%\location{Itaquaquecetuba}{SP}

% itens individuais da nominata podem ser redefinidos com os comandos
% abaixo:
% \renewcommand{\nominataReit}{Prof\textsuperscript{a}.~Wrana Maria Panizzi}
% \renewcommand{\nominataReitname}{Reitora}
% \renewcommand{\nominataPRE}{Prof.~Jos{\'e} Carlos Ferraz Hennemann}
% \renewcommand{\nominataPREname}{Pr{\'o}-Reitor de Ensino}
% \renewcommand{\nominataPRAPG}{Prof\textsuperscript{a}.~Joc{\'e}lia Grazia}
% \renewcommand{\nominataPRAPGname}{Pr{\'o}-Reitora Adjunta de P{\'o}s-Gradua{\c{c}}{\~a}o}
% \renewcommand{\nominataDir}{Prof.~Philippe Olivier Alexandre Navaux}
% \renewcommand{\nominataDirname}{Diretor do Instituto de Inform{\'a}tica}
% \renewcommand{\nominataCoord}{Prof.~Carlos Alberto Heuser}
% \renewcommand{\nominataCoordname}{Coordenador do PPGC}
% \renewcommand{\nominataBibchefe}{Beatriz Regina Bastos Haro}
% \renewcommand{\nominataBibchefename}{Bibliotec{\'a}ria-chefe do Instituto de Inform{\'a}tica}
% \renewcommand{\nominataChefeINA}{Prof.~Jos{\'e} Valdeni de Lima}
% \renewcommand{\nominataChefeINAname}{Chefe do \deptINA}
% \renewcommand{\nominataChefeINT}{Prof.~Leila Ribeiro}
% \renewcommand{\nominataChefeINTname}{Chefe do \deptINT}


%\renewcommand{\ALG@name}{Algoritmo}


% A seguir são apresentados comandos específicos para alguns
% tipos de documentos.

% Relatório de Pesquisa [rp]:
% \rp{123}             % numero do rp
% \financ{CNPq, CAPES} % orgaos financiadores

% Trabalho Individual [ti]:
% \ti{123}     % numero do TI
% \ti[II]{456} % no caso de ser o segundo TI

% Trabalho de Conclusão [tc]:
% além de definir explicitamente o nome do curso (\course) e o local
% de realização (\location), é necessário redefinir a nominata,
% pois as informações necessárias dependem do curso. Ex.:
%\renewcommand{\nominata}{
%        UNIVERSIDADE FEDERAL DO RIO GRANDE DO SUL\\
%        Reitora: Prof\textsuperscript{a}.~Wrana Maria Panizzi\\
%        Pró-Reitor de Ensino: Prof.~José Carlos Ferraz Hennemann\\
%        Diretor do Instituto de Informática: Prof.~Philippe Olivier Alexandre Navaux\\
%        Coordenador do curso: Prof.~Seu Creysson\\
%        Bibliotecária-chefe do Instituto de Informática: Beatriz Regina Bastos Haro
%}

% Monografias de Especialização [espec]:
% \espec{Redes e Sistemas Distribuídos}      % nome do curso
% \coord[Profa.~Dra.]{Weber}{Taisy da Silva} % coordenador do curso
% \dept{INA}                                 % departamento relacionado

%
% palavras-chave
% iniciar todas com letras minúsculas, exceto no caso de abreviaturas
%
\keyword{jogos online maciçamente multijogador}
\keyword{MMOG}
\keyword{simulação interativa distribuída}

\hyphenation{ma-ci-ça-men-te}
%
% inicio do documento
%
\begin{document}

% folha de rosto
% às vezes é necessário redefinir algum comando logo antes de produzir
% a folha de rosto:
% \renewcommand{\coordname}{Coordenadora do Curso}
\maketitle

% dedicatoria
%\clearpage
%\begin{flushright}
%\mbox{}\vfill
%{\sffamily\itshape
%``Se eu enxerguei mais longe,\\
% foi porque me apoiei nos ombros de gigantes.''\\}--- \textsc{Sir~Isaac Newton}
%\end{flushright}
%
%% agradecimentos
%\chapter*{Agradecimentos}
%Agradeço a todos\ldots

% sumario
\tableofcontents

% lista de abreviaturas e siglas
% o parametro deve ser a abreviatura mais longa
%\begin{listofabbrv}{SPMD}
%		\item[CRN] Continuous Random Networks (Redes Aleatórias Contínuas)
%		\item[WWW] Wooten-Winer-Weaire
%		\item[DM] Dinâmica Molecular
%\end{listofabbrv}

% idem para a lista de símbolos
%\begin{listofsymbols}{$\alpha\beta\pi\omega$}
%       \item[$\sum{\frac{a}{b}}$] Somatório do produtório
%       \item[$\alpha\beta\pi\omega$] Fator de inconstância do resultado
%\end{listofsymbols}

% lista de figuras
%\listoffigures

% lista de tabelas
%\listoftables

% resumo na língua do documento

\begin{abstract}

Este plano de curso de doutorado propõe um modelo de suporte a jogos online maciçamente multijogador fazendo uso de sistemas de compartilhamento em larga escala de recursos computacionais, tais como redes P2P. Seguindo este modelo, sobre uma rede P2P seria formado um sistema que atuaria como servidor de um jogo MMOG. A cada nodo deste sistema seria designado uma porção da carga de comunicação e processamento do jogo -- mais especificamente, seria designada a cada nodo uma região do ambiente virtual do jogo. Tal sistema seria percebido como um servidor central pelos jogadores, que conectar-se-iam a ele através de um \emph{Gateway}, sendo cada um redirecionado para o nodo servidor adequado. Para que esse sistema servidor funcione como esperado, será necessário tratar algumas questões, tais como manter consistente o andamento do jogo nos diferentes nodos servidores, de forma que cada jogador tenha a mesma visão; gerenciamento da carga atribuída a cada servidor, que por se tratar de um jogo é bastante variável e pesa muito mais na rede; o que fazer quando um nodo servidor sai da rede ou entra em colapso e, por fim, como difundir e armazenar os estados dos jogadores de maneira distribuída, de forma que sempre se possa recuperar o estado mais recente.

%Este trabalho visa analisar a aplicabilidade das técnicas utilizadas para dar suporte a jogos online maciçamente multijogador em cenários onde os recursos computacionais são mais limitados. Como geralmente são utilizadas redes de servidores de alto custo, com links que dão suporte à comunicação entre dezenas de milhares de jogadores \cite{cecin2004fsa}, é necessário revisar o que foi feito e analisar sua aplicabilidade em arquiteturas que não dispõem de tais recursos. Assim sendo, objetiva-se avaliar e, quando possível, aperfeiçoar as técnicas pesquisadas%\cite{os artigos pesquisados}
%, considerando um cenário em que a infra-estrutura de suporte se restringe a um conjunto de nodos de capacidade menor - ou super-nodos, no sentido em que têm links e capacidade de processamento superiores às dos usuários de Internet em geral, mas inferiores às dos grandes servidores. Pretende-se, por fim, construir um modelo arquitetural de suporte a jogos online maciçamente multijogador, que defina a distribuição das cargas de processamento e comunicação associadas ao jogo entre o conjunto de nodos servidores e integre - tantas quanto for possível - as técnicas pesquisadas e/ou propostas. Após isso, será feito um protótipo e simulações para validar o trabalho.

%O objetivo do trabalho é propor uma arquitetura de sistema distribuído sobre a Internet, que seja tolerante a falhas e escalável. Tal sistema funcionará como um grande servidor para jogos online maciçamente multijogador. A idéia é que diversos computadores de baixo ou médio custo, conectados à Internet, com conexão de banda larga, formem um sistema distribuído que aceitará e repartirá conexões oriundas de jogadores. Os diferentes nodos desse sistema dividirão a carga de processamento e de comunicação dos diferentes jogadores conectados, assim como a simulação do ambiente virtual do jogo. Tal sistema poderá ser expandido por novos computadores que satisfaçam alguns requisitos mínimos de capacidade de processamento, armazenamento e largura de banda disponível para transmissão e recebimento de mensagens. Também deverá ser possível que qualquer nodo se retire do sistema, delegando sua carga aos restantes. Por fim, tal sistema deverá ser tolerante a falhas, de forma a prejudicar o mínimo possível a simulação e a entrega de atualizações de estado aos clientes. O objetivo principal, além da tolerância a falhas, é que o sistema seja escalável, ou seja, suporte um grande número de jogadores, porém sem comprometer severamente a qualidade do serviço.

\end{abstract}

% resumo na outra língua
% como parametros devem ser passados o titulo e as palavras-chave
% na outra língua, separadas por vírgulas
%\begin{englishabstract}{English Title}{English KeyWords}
%
%\end{englishabstract}

% aqui comeca o texto propriamente dito

% introducao
























\chapter{Introdução}

Jogos online maciçamente multijogador -- ou MMOGs, \emph{massively multiplayer online games} -- são o tema central deste plano de doutorado. Geralmente, utiliza-se uma infra-estrutura cliente-servidor para dar suporte a este tipo de jogo. Neste plano será proposto um modelo de distribuição do lado servidor, de maneira a reduzir ou eliminar seu custo de manutenção. Nas próximas seções será apresentado o contexto referente a jogos multijogador e MMOGs.

\section{Jogos Multijogador}

% o que são
% breve histórico e exemplos
% requisitos computacionais (sem mtos detalhes)

Nas últimas décadas, desde o surgimento do computador pessoal, jogos de computador tem se popularizado de maneira crescente. Mais ainda, após o surgimento da Internet aliado ao fato de as conexões domésticas estarem cada vez mais baratas e mais rápidas, jogos online multijogador têm merecido atenção especial. Estes jogos se caracterizam por haver vários participantes interagindo uns com os outros, utilizando uma conexão através da Internet entre seus dispositivos computacionais, que são geralmente computadores pessoais ou consoles (dispositivos computacionais específicos para jogos). Este tipo de jogo pode ser dividido em vários gêneros, como por exemplo:

\begin{itemize}

\item FPS: \emph{first-person shooting}, ou jogos de tiro com visão em primeira-pessoa, em que cada jogador controla um personagem que dispõe de diferentes armas, com as quais enfrenta monstros ou personagens de outros jogadores. São caracterizados por ação rápida, incluindo atirar, mover-se, esquivar-se etc.;

\item RTS: \emph{real-time strategy}, ou jogos de estratégia em tempo-real, onde cada jogador controla um exército, mas suas ações são executadas simultaneamente às ações dos outros jogadores, ao invés de serem separadas em turnos. A ação é mais lenta que em jogos FPS;

\item RPG: \emph{role-playing game}, ou jogo de interpretação de papéis, no qual cada jogador tem um personagem que evolui com o tempo, adquirindo mais poder e acumulando tesouros. Jogos deste tipo são caracterizados por não terem um início ou fim de partida definidos, constituindo um mundo virtual de estado persistente. Os jogadores então podem evoluir seus personagens, desconectarem-se e reconectarem-se mais tarde para continuarem jogando a partir do ponto onde pararam, pois seu estado estará armazenado.

\end{itemize}

Como exemplos de jogos multijogador online conhecidos, podem ser citados \emph{Quake} \cite{quake}, um jogo do gênero FPS lançado em meados da década de 90; \emph{Starcraft: Brood War} \cite{broodwar}, da mesma época, porém consistindo de um jogo RTS, Counter-Strike \cite{counterstrike}, FPS lançado em 2000 e Diablo II \cite{diablo2}, RPG lançado no mesmo ano.




\section{Jogos Online Maciçamente Multijogador (MMOGs)}

Da mesma forma que jogos de computador evoluíram para jogos multijogador on-line após a popularização da Internet, evoluiu-se em seguida para jogos online maciçamente multijogador (ou MMOG (\emph{massively multiplayer online games}), graças ao barateamento das conexões à Internet e o aumento da sua velocidade. Jogos deste tipo têm se popularizado bastante nos últimos tempos. Além de poderem ser jogados on-line, permitem a interação simultânea de um grande número de participantes. Nos casos de maior sucesso, como World of Warcraft \cite{worldofwarcraft} e Lineage II \cite{lineage2}, por exemplo, é dado suporte a uma base de dezenas a centenas de milhares de jogadores simultâneos \cite{chen2006pch}. Estes jogadores podem, então, interagir entre si e com o ambiente virtual do jogo.

Cada jogador controla uma entidade chamada de \emph{avatar}, que nada mais é que sua representação no ambiente virtual - um personagem que executa as ações determinadas pelo jogador, que dessa forma passa a interferir na história e no encaminhamento do jogo. Para que a partida se mantenha consistente para diferentes participantes, cada alteração de cada avatar deve ser notificada para todos os jogadores que estejam por perto, ou para quem aquela mudança possa dizer respeito. Outras alterações no mundo virtual do jogo, como destruição ou criação de objetos no ambiente, e eventos, como ações de personagens controlados por computador, devem também ser transmitidos aos jogadores envolvidos.
% requisitos computacionais elevados a 1000
% 


\chapter{Motivação}
\section{Requisitos dos jogos MMOG}

O que é comum a qualquer um dos gêneros de jogos online multijogador é o fato de serem simulações interativas de tempo-real. São simulações no sentido de que simulam um mundo tão parecido quanto possível com o mundo real -- embora alguns jogos se distanciem propositalmente do realismo. A interatividade vem do fato de que há vários participantes executando ações que modificarão o andamento do jogo. Por fim, são de tempo-real porque diversas ações executadas por um jogador devem ter efeito imediato, sob pena de prejudicar alguém. Em um jogo FPS, por exemplo, espera-se que após um jogador enviar o comando de puxar o gatilho, arma de seu personagem dispare o mais rápido possível. Além disso, é necessário manter a consistência da simulação entre os jogadores, para que estes visualizem o jogo no mesmo estado.

Para jogos online multijogador de pequena escala (com, no máximo, algumas dezenas de participantes), costuma ser suficiente montar uma rede cliente-servidor, onde o servidor é o computador de um dos próprios jogadores, que a ele conectam-se através de um software cliente. Esse servidor atua como árbitro, de forma a manter o estado do jogo consistente entre os diferenetes participantes. Outra abordagem é formar uma pequena rede par-a-par entre os jogadores, utilizando algum algoritmo para manter a consistência da simulação, que agora é distribuída.


\section{Estado da arte}
\section{Questões de pesquisa}

%Jogos eletrônicos on-line têm se popularizado bastante nos últimos tempos, devido principalmente ao aumento do público com acesso à Internet, especialmente com conexões de banda larga. Como exemplos de títulos de sucesso, podem ser citados Starcraft: Brood War \cite{broodwar}, Counter-Strike \cite{counterstrike} e Warcraft III \cite{warcraft3}, que possuem a opção de multijogador (ou \emph{multiplayer}), permitindo que diferentes usuários joguem entre si.

%Mais especificamente, j


%Jogos dessa natureza têm alguns requisitos \cite{schiele2007rpp}, dentre os quais podem ser citados: \textbf{persistência} do estado do mundo virtual e dos avatares; \textbf{disponibilidade} do serviço; \textbf{consistência} do estado do mundo e dos avatares entre os diferentes participantes; \textbf{segurança}, no que se refere a tentativas de subversão das regras do jogo por trapaceiros e \textbf{escalabilidade}, tendo em vista o grande número esperado de jogadores.

\begin{itemize}

	\item \textbf{Persistência} - Jogos MMOG, em geral, consistem em um mundo virtual onde os jogadores interagem entre si e com o mundo virtual, alterando o estado do mesmo e de seus avatares (representação virtual do jogador no jogo). Espera-se que essas mudanças não sejam desfeitas entre uma sessão de jogo e outra. Por este motivo, é necessário suporte a persistência dos estados; 
		
	\item \textbf{Disponibilidade} - Em geral, jogos MMOG são pagos - tais como World of Warcraft \cite{worldofwarcraft} - e, por causa disso, seus usuários costumam ser exigentes quanto ao quesito de disponibilidade. Assim, deseja-se que, a qualquer momento, o sistema esteja disponível;
	
	\item \textbf{Consistência} - Jogos multijogador consistem em um ambiente virtual compartilhado entre os jogadores, que disputam a mesma partida. Sendo assim, é necessário que aquele ambiente seja representado de maneira equivalente nas máquinas dos diferentes jogadores para que estes possam se coordenar. Isto se torna mais complexo com o aumento do número de participantes;
	
	\item \textbf{Segurança} - Em um sistema onde há dezenas de milhares de participantes, não é razoável confiar em todos eles, o que torna necessário algum mecanismo que proveja segurança. Segurança aqui se refere não somente a autenticação de usuários cadastrados, como também verificar se os estados/ações que os diferentes jogadores enviam são válidos. Jogadores trapaceiros, por exemplo, podem alterar o software executado em suas máquinas de forma que sejam enviados estados/ações que lhes dêem alguma vantagem no jogo, o que deve ser impedido;
	
	\item \textbf{Escalabilidade} - Levando-se em conta o número de participantes em um jogo MMOG, é necessário que o sistema que lhe dá suporte seja capaz de suportar bem a carga crescente de processamento e comunicação exigida para isso. No entanto, muitas das técnicas utilizadas para jogos em pequena escala - com algumas dezenas de jogadores - não funcionam bem em cenários com um número muito maior de participantes.
	
\end{itemize}

Para dar suporte à grande quantidade de participantes, geralmente é usado o paradigma cliente-servidor, sendo que toda interação é feita através da máquina servidora. Neste paradigma, o computador servidor possui a cópia oficial do estado e é responsável pela computação sobre a mesma, enquanto o cliente atua na apresentação do estado para o usuário. O servidor é responsável, também, por atualizar os clientes, em tempo real, sobre as alterações que ocorrem no ambiente virtual do jogo. A centralização nesse computador servidor, devido ao grande número de participantes, faz com que seu custo de manutenção seja bastante elevado. Geralmente, é necessária uma capacidade de comunicação de dezenas de GBps e um razoável poder de processamento para executar toda a simulação. Torna-se inviável, por exemplo, a manutenção de jogos online maciçamente multijogador por grupos independentes sem grande disponibilidade de recursos financeiros, como o Indigente \cite{indigente}, por exemplo.

A \textbf{arquitetura cliente-servidor} supre diversos aspectos necessários para a execução satisfatória de jogos do tipo MMOG, o que inclui um alto nível de controle sobre o sistema como um todo, o que facilita autenticação, persistência e segurança. Porém isso custa caro, como já foi dito, além de ser um possível gargalo. Objetivando minimizar este problema, foram propostas algumas alternativas. Uma delas é a de usar computação agregada, onde um cluster, ao invés de um computador único, faz o papel de servidor. Tal abordagem tem um ganho expressivo de poder de processamento, mas não resolve todos os problemas dos jogos online maciçamente multijogador. Deve-se prover também a largura de banda necessária para dar suporte ao tráfego intenso entre o servidor e os jogadores.

Outra abordagem possível é a \textbf{arquitetura par-a-par}, ou P2P, onde se divide a simulação entre os computadores envolvidos. Pode-se ter um sistema sem qualquer servidor, onde os pares (antes clientes), que são as máquinas dos jogadores, entram em algum tipo de acordo para os diversos passos da simulação. No que se refere à escalabilidade, tal abordagem não é ótima, pois garantir esse "acordo"{} é custoso em termos de troca de mensagens \cite{lamport1982bgp}. Ainda que seja eleito um dos pares para decidir o andamento da simulação, ainda haverá o problema de que todos os pares precisarão trocar mensagens com todos. Tendo-se $n$ pares, há uma complexidade de O({$n^2$}) trocas de mensagem para cada passo da simulação. É evidente que tal abordagem não é tão escalável quanto se possa querer para um sistema onde se pretende executar um jogo online maciçamente multijogador. Além disso, seria necessário prover armazenamento distribuído e recuperação dos estados do jogo.

Alguns trabalhos já foram realizados no sentido de tornar jogos em redes P2P mais escaláveis, como \cite{schiele2007rpp}. Para reduzir o tráfego entre os pares, cada um envia atualizações de estado apenas àqueles que tiverem interesse nas mesmas. Para atingir este objetivo, o ambiente virtual é dividido em regiões, cada uma com um coordenador. O coordenador de cada região é eleito entre os pares ali presentes e se encarrega, apenas, de decidir para quem cada atualização de estado interessa - ele \emph{não} intermedia as trocas de mensagens entre os pares, que se comunicam diretamente entre si. No entanto, tal abordagem se baseia no fato de que aquele par seria confiável, o que não pode ser garantido, já que o software utilizado por aquele usuário pode ter sido alterado de forma a agir de maneira incorreta. Outra abordagem seria a de eleger múltiplos coordenadores por região, mas isso implicaria na implementação de algum mecanismo de votação, além de depender da disponibilidades de pares para gerenciarem. Além disso, não seria eliminada a necessidade de cada par enviar atualizações de estado a diversos outros pares. Outros trabalhos que têm proposta bastante semelhante são \cite{elrhalibi2005abm} e \cite{iimura2004zfg}.

Existem também as propostas de \textbf{arquiteturas híbridas}, que utilizam servidores ao mesmo tempo em que fazem uso de infra-estrutura P2P. %Um exemplo disso são os "pares agregados"{} \cite{chen2006pch}. Neste trabalho, é
É proposta, por exemplo, uma arquitetura onde pares e servidor dividem a simulação do jogo \cite{chen2006pch}. O ambiente virtual é dividido em regiões, cada uma gerenciada por um dos pares, que atua como um sub-servidor. É para ele que cada um dos outros pares naquela região envia cada atualização de estado, que de lá é encaminhada aos outros pares interessados na mesma. Isto pode gerar problemas de segurança e disponibilidade, já que não há garantias de que aquele par é confiável para servir aquela região, ou que ele irá permanecer no sistema enquanto for necessário. Para tratar a segurança, os autores sugerem o uso dos agregados de pares - que consistem no gerenciador de região, mais pares "reserva"{} - para fazerem verificação da simulação, além de prover robustez ao sistema, no caso do gerenciador sofrer colapso. Porém, tal abordagem novamente remete ao problema da eficiência de comunicação e escalabilidade, já que é necessário haver acordo entre os pares integrantes daquele agregado. %Haverá um sobrecusto adicional considerável, se for levado em conta que, para cada passo da simulação a ser executado, eles devem entrar em acordo.% Uma alternativa seria a utilização de validação em bloco dos passos. Periodicamente, os reservas receberiam algum tipo de histórico de eventos e, baseado nisso, verificariam a corretude da simulação que foi feita. No entanto, quanto maior o intervalo entre uma verificação e outra, maior seria a perda por roll-back para o último estado válido da simulação.

Outra arquitetura híbrida é a do FreeMMOG \cite{cecin2004fsa}. Nela, os pares se organizam de maneira P2P em cada região do ambiente virtual e o servidor intermedia a comunicação entre diferentes regiões. Novamente, tem-se o problema da segurança: os pares dentro de uma região controlam a simulação que ocorre ali, podendo subvertê-la. É feita uma abordagem probabilística, utilizando um par selecionado aleatoriamente de outro ponto do ambiente para verificar a simulação naquela região. Espera-se que, caso os pares ali desejem entrar em conluio para subverter o jogo, pelo menos o nodo inserido ali detecte as ações inválidas e reporte ao servidor. No entanto, além de não garantir completamente segurança, persiste o problema de poder haver muitos pares se comunicando com muitos, o que pode comprometer a qualidade do jogo.

%\textbf{... por esses motivos, decidiu-se utiliza o msoi (ver \emph{"discussao autista.txt"})}
O que se pretende investigar é o uso de um sistema servidor composto de "super-nodos"{} distribuídos geograficamente. Cada super-nodo teria uma capacidade de processamento e link de comunicação mínimos exigidos para fazer parte do sistema. No entanto, como a simulação seria distribuída entre eles, não seria necessário que cada um destes super-nodos tivesse a mesma capacidade de processamento ou comunicação possuída pelos grandes servidores centrais usados comumente para jogos MMOG. O mundo do jogo poderia então ser dividido em regiões, cada uma gerenciada por um destes super-nodos. Dessa forma, os jogadores que estivessem em uma dada região apenas enviariam atualizações de estado àquele nodo servidor, que as processaria, armazenaria e enviaria para a quem fossem relevantes.

Utilizando esta abordagem, seria preciso apenas garantir a confiabilidade dos nodos servidores, que, então, verificariam se cada ação dos jogadores é válida. %Levando em conta que cada nodo servidor estaria apto a gerenciar dezenas ou centenas de jogadores, haveria muito menos servidores do que jogadores. 
Assim, torna-se mais simples a tarefa de garantir segurança no sistema, pois pode-se assumir que cada super-nodo é confiável%um número bem mais reduzido de nodos podem ser assumidos como confiáveis
. Outro aspecto - o da disponibilidade - seria melhor satisfeito, pois cada região do mundo virtual estaria sendo servida por um nodo que estaria dedicado a esta tarefa. %Isto é mais desejável do que designar cada região a um par controlado por jogador, como sugerido em alguns trabalhos, pois jogadores saem e entram de volta no jogo de maneira imprevisível.%, o que poderia ser um ponto fraco da abordagem destes autores.

Seguindo esta última vertente, existem alguns problemas que, ou estão por resolver, ou estão sendo pesquisados atualmente, tais como:

\begin{itemize}

\item Encontrar uma maneira de particionar o espaço virtual, mapeando cada região a um nodo servidor, de forma que nodos com boa comunicação entre si estejam próximos na topologia lógica da rede;

\item	Balancear dinamicamente a carga da simulação entre os nodos servidores, de forma que seja mantida uma qualidade mínima de serviço em cada uma das diferentes regiões do ambiente virtual;

\item Manter consistente a simulação nas diferentes regiões, entre jogadores da mesma região, e de jogadores em regiões adjacentes;

\item	Coordenar a entrada, a saída e a detecção de colapso de nodos do sistema;

\item	Distribuir o armazenamento persistente do estado dos jogadores, de forma a poder recuperá-lo quando necessário;

\item	Otimizar a comunicação entre clientes e servidores, de forma a economizar o máximo possível de largura de banda, sem que isso seja perceptível pelos jogadores;

\item	Como cada nodo tem recursos mais limitados que os de um grande servidor central, deve-se buscar algoritmos adaptativos que tornem a simulação (atualizações de estado e sincronização da simulação entre os clientes) coerente com os recursos disponíveis no momento;

%\item	Tornar o sistema como um todo o mais escalável possível, mesmo que para isso seja necessário relaxar algumas restrições, como consistência global, por exemplo;
%
%\item	Tornar esse sistema tolerante a falhas, pois ele será dinâmico (entrada e saída de nodos do sistema) e conterá diversos pontos passíveis de terem problemas.

\end{itemize}

Foram feitos trabalhos que buscam tratar alguns destes problemas, como balanceamento de carga \cite{lee2003sdl}, assim como foram feitas algumas propostas de arquiteturas de suporte a MMOG \cite{ng2002msa} e \cite{assiotis2006dam}. No entanto, tais propostas levam em consideração que os servidores são de grande porte e ligados através de links de comunicação poderosos, havendo muito pouco atraso entre eles. Cabe, então, fazer a análise da aplicabilidade das técnicas já pesquisadas em um contexto de recursos mais escassos e propor, tendo isso em vista, aperfeiçoamento das mesmas e uma arquitetura que as integre, além de efetuar implementação e testes de um protótipo que as utilize.

%
%\begin{figure}
% \centering
% \includegraphics[width=0.50\textwidth]{imagens/www}
% \caption{Troca de ligações no algoritmo WWW. Esquerda: configuração inicial; Direita: configuração após a troca}
% \label{fig:WWW}
%\end{figure}
%\begin{equation}
%	\label{equ:Hib}
%	 Hib=\frac{1}{N}\sum_{i=1}^NC_i(N_i-N_{0_i})^2 
%\end{equation}

%\begin{equation}
%	\label{equ:Ene}
%	 Energ=\sum_{r_{ij}<r_{max}}[k_r(r_{ij}-r_{0_{ij}})^2+\sum_{r_{ik}<r_{max}}K_a(\theta_{ijk}-\theta_{0_i})^2] 
%\end{equation}














\chapter{Objetivo}
\section{Objetivo geral}
O objetivo é criar um modelo arquitetural de suporte a jogos online maciçamente multijogador. Seguindo este modelo, deverá ser possível formar um sistema geograficamente distribuído de nodos servidores, utilizando a Internet como meio de ligação entre os mesmos. Além de distribuir as cargas computacionais (comunicação e processamento) impostas pelo grande número de jogadores, este modelo deverá incluir técnicas com o fim de reduzir o tráfego entre os componentes deste sistema (nodos servidores e máquinas clientes dos jogadores), economizando largura de banda. Tais técnicas são o foco deste trabalho, tendo em vista que se considera um cenário com recursos voláteis e limitados, já que a ligação entre os nodos será feita através da Internet.

Existem outros aspectos relevantes, além da distribuição do servidor e da economia de largura de banda, que poderão ser acrescentados ao modelo, dependo da disponibilidade de tempo para realizar tal tarefa.

\section{Objetivos específicos}
%A função deste middleware será de abstrair para a camada do jogo, que ficará acima dele, o sistema geograficamente distribuído servidor. distribuir as cargas de processamento e comunicação entre 
%
%sistema distribuído sobre a Internet, que funcionará como um grande servidor para jogos online maciçamente multijogador. Pode ser utilizado o conceito de "super-nodo", que nada mais é que um computador conectado à Internet, com capacidade de processamento e comunicação acima da média de usuários comuns, mas que, ainda assim, é bem mais limitado que os grandes servidores que costumam servir os jogos MMOG mais conhecidos. A idéia é que diversos destes super-nodos, conectados à Internet, formem um sistema distribuído que aceitará e repartirá conexões oriundas de jogadores. Eles então dividirão a carga de processamento e de comunicação dos diferentes jogadores conectados, assim como a simulação do ambiente virtual do jogo.

%Para atingir este objetivo, algumas metas são traçadas:
%
%\begin{enumerate}
%
%\item Revisar as técnicas utilizadas para dar suporte a jogos MMOG;
%
%\item Analisar a aplicabilidade destas técnicas em cenários em que cada nodo do sistema tem recursos mais limitados;
%
%\item Propor integração das mesmas, com otimizações focadas no contexto definido (disponibilidade de super-nodos, ao invés de servidores poderosos);
%
%\item Implementar um protótipo que integre as técnicas estudadas e/ou desenvolvidas no trabalho;
%
%\item Efetuar simulações que demonstrem o resultado obtido do trabalho e avaliar seus resultados.
%
%\end{enumerate}















\chapter{Plano de trabalho}
\section{Metodologia}

Para atingir o objetivo definido na seção anterior, deverão ser cumpridas algumas etapas, que são as seguintes:

\begin{enumerate}

	\item Revisar as técnicas utilizadas para dar suporte distribuído a jogos MMOG;
	
	Será dada continuidade à investigação bibliográfica que já foi iniciada para elaboração deste plano de estudos e pesquisa, além de buscar separá-las em categorias segundo: contexto considerado e problemas que buscam solucionar.

	\item Analisar a aplicabilidade destas técnicas em cenários em que cada nodo do sistema tem recursos mais limitados;
	
	Técnicas utilizadas para dar suporte distribuído a jogos MMOG costumam se basear em cenários onde há grande disponibilidade de recursos, com grandes servidores ligados através de rede local com capacidade de comunicação super-dimensionada. Será analisada a viabilidade de serem utilizadas em um contexto onde os nodos têm recursos mais limitados.

	\item Propor integração das mesmas, com otimizações focadas no contexto definido (disponibilidade de super-nodos, ao invés de servidores poderosos);
	
	Buscar-se-á fazer aperfeiçoamento de algumas destas técnicas, tendo como ênfase o contexto de super-nodos distribuídos geograficamente e, posteriormente, será proposta uma integração das mesmas% em uma arquitetura de suporte a MMOG
.

	\item Implementar um protótipo que integre as técnicas estudadas e/ou desenvolvidas nas etapas anteriores;

	\item Efetuar simulações que demonstrem o resultado obtido do trabalho e avaliar seus resultados.

\end{enumerate}

%
%As etapas que esse trabalho seguirão são:
%
%\begin{enumerate}
%
%	\item Dar continuidade à investigação bibliográfica de técnicas de otimização do suporte a jogos MMOG

%	\item Propor uma arquitetura preliminar de suporte a jogos MMOG, que dê ênfase a escalabilidade e a tolerância a falhas;
%
%Tal arquitetura \textbf{provavelmente (bom ou ruim?)} seguirá a vertente de sistema geograficamente distribuído de servidores, apresentada na seção anterior, para distribuir o processamento e a comunicação necessários para a execução de um MMOG.
%
%	\item Buscar algoritmos de particionamento que dividam o mundo virtual entre os nodos de maneira que os jogadores possam ter uma experiência de jogo satisfatória;
%
%Pretende-se evitar o uso de algoritmos que necessitem de informações globais do sistema, de forma que o particionamento e balanceamento de carga possa ser executada com apenas um subconjunto de nodos. Dessa forma, o particionamento dificilmente será ótimo, mas seu tempo de execução estará dentro dos limites do aceitável, e espera-se que tal particionamento consiga uma divisão do mundo que possibilite uma boa experiência de jogo.
%
%	\item Pesquisar uma técnica de sincronização entre os servidores, de forma que o estado dos mesmos - e dos jogadores a eles conectados - tenha consistência satisfatória;
%
%Não se pretende garantir consistência global, pois o estado de cada jogador ou objeto presente no mundo não é necessariamente relevante para todas as outras partes integrantes do ambiente.
%
%	\item Pesquisar técnicas de tolerância a falhas, de forma a tornar o sistema mais robusto;
%	
%Como a simulação será distribuída, haverá diversos pontos suscetíveis a falha, tornando necessário o emprego de alguma técnica de tolerância a falhas que minimize este problema. \textbf{Provavelmente}, serão utilizadas réplicas para cada servidor, cuja finalidade é apenas manter-se atualizada e estar pronta para substituir o nodo servidor original no caso de falha do mesmo.
%
%	\item Integrar os algoritmos e técnicas pesquisados e executar simulações para medir seu desempenho.
%\end{enumerate}

%\begin{algorithm}
%\caption{Algoritmo para geração de CRN}
%\begin{algorithmic}[1]
%\label{alg:crn}
%\FOR{$i=0$ to $STEPS$}
%\STATE{at = atomos[rand(NATM)];}\COMMENT{\textit{pega um átomo aleatóriamente}}
%\STATE{E\_local = local\_energy(at);}\COMMENT{\textit{calcula a energia local da célula onde o átomo está inserido}}
%\STATE{Hibri = hibri\_cost(at);}\COMMENT{\textit{calcula o custo de hibridização local da célula onde o átomo está inserido}}
%\STATE{at$\rightarrow$x = at$\rightarrow$x + randf();}\COMMENT{\textit{desloca o átomo na direção x}}
%\label{desloc_ini}
%\STATE{at$\rightarrow$y = at$\rightarrow$y + randf();}\COMMENT{\textit{desloca o átomo na direção y}}
%\STATE{at$\rightarrow$z = at$\rightarrow$z + randf();}\COMMENT{\textit{desloca o átomo na direção z}}
%\label{desloc_fim}
%\STATE{E\_local\_new = local\_energy(at);}\COMMENT{\textit{calcula a nova energia local da célula onde o átomo está inserido}}
%\STATE{Hibri\_new = hibri\_cost(at);}\COMMENT{\textit{calcula o novo custo de hibridização local da célula onde o átomo está inserido}}
%
%\STATE{dE = E\_new - E\_old;}\COMMENT{\textit{calcula a variação de energia}}
%\STATE{dH = Hibri\_new - Hibri\_old;}\COMMENT{\textit{calcula a variação do custo de hibridização}}
%		
%		
%\STATE{dfc = (1.0f - COST\_HIBRI)*(dE) + COST\_HIBRI*(dH);}\COMMENT{\textit{calcula a variação da função custo}}
%
%\IF{aceita(dfc)}%\COMMENT{\textit{verifica a aceitação de acordo com a temperatura atual}}
%\STATE{atualiza\_posicao();}\COMMENT{\textit{atualiza a posição do átomo}}
%\ELSE
%\STATE{desfaz\_movimento();}\COMMENT{\textit{volta átomo para posição anterior}}
%\ENDIF
%
%\STATE{temperatura = temperatura * 0.98}\COMMENT{\textit{diminui a temperatura}}
%
%
%\ENDFOR
%\end{algorithmic}
%\end{algorithm}

%\chapter{Metodologia}
%
%As etapas para o desenvolvimento desse trabalho serão:
%
%\begin{enumerate}
%	\item Pesquisar mais a fundo as técnicas utilizadas em trabalhos relacionados, buscando pontos em que possam ser melhoradas;
%
%	\item 
%
%	\item Encontrar maneiras de otimizar essa implementação seqüencial. 
%		
%	\item Buscar formas de paralelizar a aplicação tentando diminuir ainda mais o tempo de execução.
% Primeiramente essa paralização será feita pela adição da primitivas OpenMP \cite{Chandra-00} no programa seqüencial para tentar explorar o paralelismo nas máquinas multiprocessadas e em novas máquinas multi-core. Essas primitivas serão introduzidas na etapa de cálculo local, que é a etapa que consome mais tempo de processamento e pode facilmente ser paralalelizada através da primitiva ``\textit{parallel for}''. 
%Espera-se, com essa alteração, uma diminuição no tempo de execução, porém, como apenas pequenas partes do programa poderão ser paralelizadas e as máquinas disponíveis para simulação tem no máximo quatro processadores, acredita-se que o tempo de execução continuará ainda alto.%, necessitando assim, uma outra etapa de paralelização.
%	\item Buscar formas de paralelizar a aplicação através do uso da biblioteca de troca de mensagens MPI \cite{Pacheco-96,Snir-98} (\textit{Message Passing Interface}). Essa etapa tem duas fases previstas:
%				
%\begin{enumerate}
%	\item Na primeira, será realizada uma paralelização de forma simples, usando primitivas básicas do MPI. Nessa fase as redes serão geradas com o auxílio de algoritmos genéticos para tentar convergir mais rapidamente em um estado estável.
%	\item Na segunda, além da utilização das primitivas básicas, tentar-se-á introduzir primitivas novas, presentes na norma MPI-2 \cite{Gropp-99}. Uma dessas primitivas é a \textit{MPI\_Comm\_spawn}, que possibilita a criação dinâmica de novos processos. Esses processos serão criados para permitir uma maior concorrência na geração das redes. Com a utilização do MPI, pretende-se obter um bom desempenho, diminuindo significativamente o tempo de execução da aplicação, uma vez que um número bem maior de processadores poderá ser utilizado. 
%\end{enumerate}
%				
%			\end{enumerate}
%
%
%
%
%
%


























\section{Cronograma}

A Tabela \ref{tab:cronograma} apresenta o
cronograma de atividades a serem desenvolvidas, conforme citadas abaixo

\begin{enumerate}
	\item Levantamento bibliográfico do estado-da-arte das técnicas de distribuição do suporte a MMOG;
	\item Levantamento bibliográfico de técnicas de distribuição em geral, que possam ser aplicadas a jogos MMOG;
	\item Análise e categorização destas técnicas;
	\item Elaboração de um modelo arquitetural de suporte distribuído a jogos MMOG;
	\item Integração das técnicas no modelo proposto;
	\item Implementação de um protótipo com o fim de testes;
	\item Levantamento dos simuladores mais indicados para efetuar tais testes;
	\item Execução dos testes em um dos simuladores pesquisados;
	\item Análise dos resultados;
	\item Apresentação do seminário de andamento na semana acadêmica;
	\item Escrita da dissertação;
	\item Escrita de artigos;
	\item Entrega da dissertação;
	\item Defesa da dissertação;
%	\item Elaboração de artigo a ser submetido para WSCAD;
%	\item Elaboração de artigo científico relativo ao trabalho já desenvolvido na Dissertação;
%	\item Desenvolvimento do Seminário de Andamento;
%	\item Semana acadêmica;
%	\item Paralelização através do Open-MP;
%	\item Paralelização através do MPI;
%	\item Paralelização através do MPI-2;
%	\item Comparação de resultados;
%	\item Redação da dissertação;
%	\item Elaboração de artigo a ser submetido em evento da área (Alto desempenho e Física computacional);
%	\item Entrega da dissertação;
%	\item Defesa da dissertação
\end{enumerate}

\begin{table}[!ht]

\begin{center}
\caption{Cronograma}
\label{tab:cronograma}
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline
Etapa 
   &Jan&Fev&Mar&Abr&Mai&Jun&Jul&Ago&Set&Out&Nov&Dez&Jan&Fev\\ \hline
1  & X & X & X &   &   &   &   &   &   &   &   &   &   &   \\ \hline
2  & X & X & X &   &   &   &   &   &   &   &   &   &   &   \\ \hline
3  &   & X & X & X &   &   &   &   &   &   &   &   &   &   \\ \hline
4  &   &   & X & X & X &   &   &   &   &   &   &   &   &   \\ \hline
5  &   &   &   & X & X &   &   &   &   &   &   &   &   &   \\ \hline
6  &   &   &   &   & X & X & X & X &   &   &   &   &   &   \\ \hline
7  &   &   &   &   &   &   & X & X &   &   &   &   &   &   \\ \hline
8  &   &   &   &   &   &   &   &   & X &   &   &   &   &   \\ \hline
9  &   &   &   &   &   &   &   &   &   & X & X &   &   &   \\ \hline
10 &   &   &   &   & X &   &   &   &   &   &   &   &   &   \\ \hline
11 &   &   &   &   & X & X & X & X & X & X & X & X &   &   \\ \hline
12 &   &   &   &   &   &   &   &   & X & X & X & X & X &   \\ \hline
13 &   &   &   &   &   &   &   &   &   &   &   & X &   &   \\ \hline
14 &   &   &   &   &   &   &   &   &   &   &   &   &   & X \\ \hline
\end{tabular}
\end{center}
\end{table}

\section{Planejamento dos créditos}

\chapter{Informações do candidato}
\section{Dados de identificação}
\section{Experiência com pesquisa}

\bibliography{planodoc}
\bibliographystyle{abnt} 























\chapter*{Assinaturas}



\vspace{2cm}



\begin{center}
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_  \\
Carlos Eduardo Benevides Bezerra


\vspace{4cm}



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_  \\
Prof.~Dr. Cláudio Fernando Resin Geyer

\end{center}


\end{document}
